<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta do Estudante</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 700px;
  margin: auto;
  padding: 20px;
}

button {
  background: #1976d2;
  color: white;
  border: none;
  padding: 10px;
  width: 100%;
  cursor: pointer;
}

.card {
  border: 1px solid #ccc;
  padding: 15px;
  margin-top: 20px;
}
</style>
</head>

<body>

<h2>Consulta de Notas</h2>

<label>Turma</label>
<select id="turma">
  <option value="">Selecione</option>
  <option value="5A">5A</option>
</select>

<label>RA</label>
<input id="ra">

<button onclick="consultar()">Consultar</button>

<div id="resultado"></div>

<script>
async function carregarTurma(turma) {
  return new Promise((resolve, reject) => {
    const s = document.createElement("script");
    s.src = `${turma}/${turma}.js`;
    s.onload = resolve;
    s.onerror = reject;
    document.body.appendChild(s);
  });
}

async function consultar() {
  const turma = document.getElementById("turma").value;
  const ra = document.getElementById("ra").value.trim();
  const r = document.getElementById("resultado");
  r.innerHTML = "";

  try {
    await carregarTurma(turma);
  } catch {
    return r.innerHTML = "Arquivo da turma não encontrado.";
  }

  const registro = DADOS_TURMA.find(a => a.ra === ra);
  if (!registro) return r.innerHTML = "RA não encontrado.";

  const aluno = JSON.parse(
    CryptoJS.AES.decrypt(registro.dados, ra).toString(CryptoJS.enc.Utf8)
  );

  r.innerHTML = `
    <div class="card">
      <h3>${aluno.nome}</h3>
      <p><strong>Turma:</strong> ${aluno.turma}</p>
      <p><strong>${aluno.bimestre}</strong></p>

      <ul>
        <li>Língua Portuguesa: ${aluno.notas.LP}</li>
        <li>Arte: ${aluno.notas.ARTE}</li>
        <li>Educação Física: ${aluno.notas.EF}</li>
        <li>Ensino Religioso: ${aluno.notas.ER}</li>
        <li>Matemática: ${aluno.notas.MAT}</li>
        <li>Geografia: ${aluno.notas.GEO}</li>
        <li>História: ${aluno.notas.HIS}</li>
        <li>Ciências: ${aluno.notas.CIE}</li>
      </ul>

      <p><strong>Total de faltas:</strong> ${aluno.faltas}</p>
    </div>
  `;
}
</script>

</body>
</html>
